
## Выгрузка информации о файлах и папках, которыми поделился пользователь

> ВНИМАНИЕ! Данный скрипт не являются официальными и предоставляются как пример работы с Яндекс Диском

> Скрипт работает только при включенном в организации адресном доступе на файлы и папки

### Подготовка и запуск

1.	Подготовить `OAuth токен` приложения для выгрузки списка пользователей.
    1. [Создание OAuth-приложения и получение токена](https://yandex.ru/dev/api360/doc/ru/access)
    2.	Необходимо выпустить токен с правами:
        ```
        directory:read_users
        ```
2.	Создать сервисное приложение с правами на чтение диска и информации о диске.
    1.	[Подключение сервисных приложений](https://yandex.ru/support/yandex-360/business/admin/ru/security-service-applications)
    2.	Требуемые права для сервисного приложения:
        ```
        cloud_api:disk.info
        cloud_api:disk.read
        cloud_api:disk.app_folder
        ```
3.	Загрузить этот проект со скриптами
4.	Установить зависимости: `pip install -r requirements.txt`
5.	Создать в корне проекта файл `.env` содержащий:
    ```
    TOKEN=oauth_токен_приложения_из_п1
    ORG_ID=идентификатор_организации_яндекс360
    CLIENT_ID=идентификатор_сервисного_приложения
    CLIENT_SECRET=секрет_сервисного_приложения
    ```
6.	Запустить скрипт, который выгружает пользователей организации
    1.	`python listusers.py`
    2.	Список пользователей организации будет сохранен в файл `users.csv`
7.	При необходимости отредактируйте файл с пользователями и оставьте только тех пользователей, по которым необходимо получить информацию. `Не удаляйте верхнюю строку CSV файла`
8.	Запустить скрипт, выгружающий информацию по доступам к файлам и папкам, которые настроили пользователи
    1.	`python disk_resources.py --users users.csv`
    2.	Данные о доступах будут загружены в файл `disk_report.csv`
    3.	Лог работы скрипта будет сохранен в файл `disk_report.log`
    4.	Если в логе появляются ошибки: `Ошибка при обработке ресурсов пользователя` проверьте, что пользователь не заблокирован. Получить информацию по заблокированным пользователям невозможно

### Результат работы скрипта

В результате работы скрипта будет получен файл `disk_report.csv`. Если такой файл уже существует, он будет перезаписан.

### Значения столбцов файла отчета

- `email` – email пользователя
- `path` – путь к файлу или папке на диске пользователя
- `access_type` – способ, которым пользователь поделился файлом или папкой
    - `public` – пользователь создал публичную ссылку, доступную всем
    - `employees` – пользователь создал публичную ссылку, доступную только сотрудникам организации
    - `group` – пользователь настроил доступ для группы пользователей организации
    - `department` – пользователь настроил доступ для подразделения организации
    - `user` – пользователь выдал доступ персонально другому пользователю (внутри или вне организации)
- `rights` – права выданные на файл или папку
    - `read` – просмотр и скачивание
    - `write` – просмотр и редактирование (загрузка в папку, если доступ указан для папки)
    - `read_without_download` – только просмотр, без скачивания
- `user_id`
    - `Пустое значение` - если доступ выдан по публичной ссылке
    - `ID пользователя` - если выдан доступ персонально другому пользователю
    - `ID группы` - если доступ выдан на группу
	- `ID подразделения` - если доступ выдан на подразделение
- `external_user`
    - `False` – если доступ выдан персонально другому пользователю из организации
    - `True` – если доступ выдан персонально пользователю не принадлежащему организации
    - `Пустое значение` – если настроен доступ по публичной ссылке


